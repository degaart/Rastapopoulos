url: ncurses-6.0.tar.gz
version: 6.0
extract-dir: ncurses-6.0
configure:
    CPPFLAGS="$CPPFLAGS -P" \
    "$EXTRACT_DIR"/configure \
        --prefix="$PREFIX" \
        --enable-pc-files  \
        --with-pkg-config-libdir="$PREFIX/lib/pkgconfig" \
        --enable-sigwinch \
        --enable-symlinks \
        --enable-widec \
        --with-manpage-format=normal \
        --with-shared \
        --with-gpm=no \
        --without-tests

build:
    make

install:
    make install
    ########
    cd "$PREFIX/lib"
    system="$(uname)"
    for i in form menu ncurses panel
    do
        if [ "$system" = Darwin ]; then
            ln -svf "lib${i}w.6.dylib" "lib${i}.dylib"
            ln -svf "lib${i}w.6.dylib" "lib${i}.6.dylib"
        else
            ln -svf "lib${i}w.so.6" "lib${i}.so"
            ln -svf "lib${i}w.so.6" "lib${i}.so.6"
        fi
        ln -svf "lib${i}w.a" "lib${i}.a"
        ln -svf "lib${i}w_g.a" "lib${i}_g.a"
    done
    ln -svf "libncurses++w.a" "libncurses++.a"
    ln -svf "libncurses.a" "libcurses.a"
    if [ "$system" = Darwin ]; then
        ln -svf "libncurses.dylib" "libcurses.dylib"
    else
        ln -svf "libncurses.so" "libcurses.so"
        ln -svf "libncurses.so" "libtinfo.so"
    fi
    ########
    cd "$PREFIX/lib/pkgconfig"
    ln -svf ncursesw.pc ncurses.pc
    ########
    cd "$PREFIX/bin"
    ln -svf ncursesw6-config ncurses6-config
    ########
    cd "$PREFIX/include"
    for i in curses.h form.h ncurses.h panel.h term.h termcap.h
    do
        ln -svf "ncursesw/$i" .
    done

detect:
    tmpfile="/tmp/detect-curses.$$.c"
    trap "rm -f $tmpfile" EXIT
    echo '#include <stdio.h>
    #include <curses.h>
    int main() {
        printf("%d.%d\n",
            NCURSES_VERSION_MAJOR,
            NCURSES_VERSION_MINOR);
        return 0;
     }' > "$tmpfile"
     buildenv cctest compile_and_run "$tmpfile" 2> /dev/null


